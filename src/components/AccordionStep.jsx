// AccordionStep.jsx
import React, { useState } from "react";
import PhotoOverlay from "./PhotoOverlay";
import PhotoCarousel from "./PhotoCarousel";
import "./AccordionStep.css";

const AccordionStep = ({ stepIndex, data = [], onComplete, activeBtnMain }) => {
  const [photos, setPhotos] = useState(data);
  const [showOverlay, setShowOverlay] = useState(false);

  // 游녢 ahora controlamos el m치ximo de 5
  const handleSavePhoto = (dataUrl, comment, blob) => {
    if (photos.length >= 5) return; // no agrega m치s de 5
    const newPhoto = { photo: dataUrl, comment, blob };
    const updated = [...photos, newPhoto];
    setPhotos(updated);
    onComplete(updated);
  };

  return (
    <div className="accordion-step">
      {/* Bot칩n deshabilitado si ya lleg칩 a 5 */}

      {/* Carrusel de previews */}
      {photos.length > 0 && <PhotoCarousel photos={photos} />}
      
       {activeBtnMain===false && (
      <div className="controls">
        <button
          className="save"
          onClick={() => setShowOverlay(true)}
          disabled={photos.length >= 5}
        >
          <svg
            width="25"
            height="19"
            viewBox="0 0 25 19"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M12.3506 6.67236C14.6426 6.67243 16.5057 8.52432 16.5059 10.8003C16.5059 13.0764 14.6426 14.9291 12.3506 14.9292C10.0585 14.9292 8.19434 13.0764 8.19434 10.8003C8.19448 8.52431 10.0585 6.67236 12.3506 6.67236ZM12.3506 8.33936C12.0835 8.33936 11.8663 8.55433 11.8662 8.8208V10.2212H10.4561C10.1891 10.2212 9.97188 10.4363 9.97168 10.7026C9.97168 10.9692 10.189 11.1841 10.4561 11.1841H11.8662V12.5854C11.8664 12.8518 12.0836 13.0669 12.3506 13.0669C12.6175 13.0668 12.8347 12.8518 12.835 12.5854V11.1841H14.2451C14.512 11.1839 14.7285 10.9691 14.7285 10.7026C14.7283 10.4364 14.5119 10.2214 14.2451 10.2212H12.835V8.8208C12.8349 8.55437 12.6176 8.33942 12.3506 8.33936Z"
              stroke="#0088FF"
              stroke-width="0.15"
            />
            <path
              d="M21.0967 6.20947C21.4568 6.20966 21.748 6.50033 21.748 6.85693C21.748 7.21354 21.4566 7.50421 21.0967 7.50439C20.7366 7.50439 20.4444 7.21365 20.4443 6.85693C20.4443 6.50022 20.7364 6.20947 21.0967 6.20947Z"
              stroke="#0088FF"
              stroke-width="0.15"
            />
            <path
              d="M8.46582 0.888184H16.2217C16.4957 0.888184 16.7283 1.09251 16.7617 1.36279L16.9736 3.05127C17.0682 3.80315 17.7128 4.36955 18.4746 4.36963H23.2617C23.5619 4.3697 23.8057 4.61311 23.8057 4.91064V17.5708C23.8057 17.8683 23.5619 18.1108 23.2617 18.1108H1.4375C1.13741 18.1107 0.893555 17.8683 0.893555 17.5708V4.90967C0.893682 4.6123 1.13749 4.3698 1.4375 4.36963H6.21289C6.97472 4.36961 7.61927 3.80311 7.71387 3.05127L7.9248 1.36182C7.95879 1.09219 8.19094 0.888406 8.46582 0.888184ZM12.3506 5.7085C9.52485 5.7085 7.22559 7.9922 7.22559 10.8003C7.22562 13.6089 9.52486 15.8921 12.3506 15.8921C15.175 15.8919 17.4746 13.6094 17.4746 10.8003C17.4746 7.99231 15.1751 5.70867 12.3506 5.7085ZM21.0967 5.24658C20.2035 5.24658 19.4757 5.96835 19.4756 6.85693C19.4756 7.74618 20.204 8.46826 21.0967 8.46826C21.9898 8.46804 22.7168 7.74545 22.7168 6.85693C22.7167 5.96847 21.9891 5.2468 21.0967 5.24658Z"
              stroke="#0088FF"
              stroke-width="0.15"
            />
            <path
              d="M8.4668 0.0751953H16.2227C16.9092 0.0754155 17.4891 0.58571 17.5742 1.26172L17.7861 2.95117C17.829 3.2972 18.1254 3.55642 18.4746 3.55664H23.2617C24.0136 3.55664 24.6249 4.16441 24.625 4.91016V17.5713C24.6249 18.3171 24.0136 18.9248 23.2617 18.9248H1.43848C0.686628 18.9248 0.0752547 18.3171 0.0751953 17.5713V4.91016C0.0752602 4.16437 0.686632 3.55664 1.43848 3.55664H6.21387C6.56256 3.55657 6.85941 3.2968 6.90234 2.95117L7.11328 1.26172C7.19842 0.585538 7.77942 0.0751953 8.4668 0.0751953ZM8.4668 0.738281C8.16072 0.738424 7.89497 0.937335 7.80469 1.21875L7.77734 1.34375L7.56641 3.0332C7.48123 3.7093 6.90056 4.21965 6.21387 4.21973H1.43848C1.05644 4.21973 0.744205 4.52878 0.744141 4.91016V17.5713C0.7442 17.9527 1.05644 18.2617 1.43848 18.2617H23.2617C23.6438 18.2617 23.956 17.9527 23.9561 17.5713V4.91113C23.9561 4.5297 23.6438 4.2207 23.2617 4.2207H18.4746C17.7879 4.22048 17.2081 3.70938 17.123 3.0332L16.9111 1.34473C16.8683 0.99863 16.5719 0.738501 16.2227 0.738281H8.4668Z"
              fill="#0088FF"
              stroke="#0088FF"
              stroke-width="0.15"
            />
            <path
              d="M12.3506 5.85889C15.0932 5.85889 17.3241 8.07603 17.3242 10.8003C17.3242 13.5252 15.0933 15.7427 12.3506 15.7427C9.60684 15.7426 7.37598 13.5251 7.37598 10.8003C7.37606 8.07609 9.60689 5.85898 12.3506 5.85889ZM12.3506 6.52197C9.97668 6.52207 8.045 8.44053 8.04492 10.8003C8.04492 13.1601 9.97661 15.0795 12.3506 15.0796C14.7247 15.0796 16.6562 13.1601 16.6562 10.8003C16.6562 8.4405 14.7246 6.52197 12.3506 6.52197Z"
              fill="#0088FF"
              stroke="#0088FF"
              stroke-width="0.15"
            />
            <path
              d="M21.0967 5.39648C21.908 5.39651 22.5674 6.05251 22.5674 6.85742C22.5672 7.66277 21.9074 8.31834 21.0967 8.31836C20.2854 8.31836 19.6261 7.66226 19.626 6.85742C19.626 6.05251 20.2859 5.39648 21.0967 5.39648ZM21.0967 6.05957C20.6545 6.05957 20.2949 6.41694 20.2949 6.85742C20.2951 7.2977 20.6545 7.65527 21.0967 7.65527C21.5388 7.65525 21.8983 7.29768 21.8984 6.85742C21.8984 6.41696 21.5388 6.05959 21.0967 6.05957Z"
              fill="#0088FF"
              stroke="#0088FF"
              stroke-width="0.15"
            />
            <path
              d="M12.3506 8.48926C12.5357 8.48926 12.6845 8.6376 12.6846 8.82031V10.3711H14.2451C14.4301 10.3711 14.5789 10.52 14.5791 10.7021C14.5791 10.8849 14.4303 11.0342 14.2451 11.0342H12.6846V12.585C12.6844 12.7676 12.5356 12.916 12.3506 12.916C12.1656 12.9159 12.0168 12.7675 12.0166 12.585V11.0342H10.4561C10.2709 11.0342 10.1221 10.8849 10.1221 10.7021C10.1223 10.5195 10.271 10.3711 10.4561 10.3711H12.0166V8.82031C12.0167 8.63766 12.1656 8.48937 12.3506 8.48926Z"
              fill="#0088FF"
              stroke="#0088FF"
              stroke-width="0.15"
            />
          </svg>
        </button>

        <button className="saveVideo" disabled>
          <svg
            width="30"
            height="18"
            viewBox="0 0 30 18"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M28.7296 2.01402C28.3473 1.81795 27.9188 1.73262 27.4914 1.76749C27.0641 1.80236 26.6546 1.95606 26.3084 2.21158L22.8067 4.82927V3.04024C22.8053 2.23437 22.488 1.46191 21.9242 0.89207C21.3605 0.322228 20.5964 0.00145073 19.7991 0H3.01303C2.21487 -1.30968e-06 1.44931 0.320134 0.884418 0.890133C0.319521 1.46013 0.00144303 2.23342 4.89135e-06 3.04024V14.9488C-0.000708863 15.3492 0.0766984 15.7459 0.227798 16.116C0.378897 16.4862 0.600722 16.8226 0.880579 17.106C1.16044 17.3894 1.49283 17.6142 1.85874 17.7676C2.22465 17.921 2.6169 18 3.01303 18H19.7991C20.5964 17.9986 21.3605 17.6778 21.9242 17.1079C22.488 16.5381 22.8053 15.7656 22.8067 14.9598V13.1762L26.3084 15.8049C26.7046 16.1004 27.184 16.26 27.6764 16.2604C28.0426 16.2585 28.4032 16.1702 28.7296 16.0024C29.1127 15.8077 29.4344 15.5089 29.6588 15.1395C29.8832 14.7702 30.0013 14.345 30 13.9116V4.09939C30.0003 3.66691 29.8817 3.24285 29.6574 2.8746C29.433 2.50634 29.1118 2.20838 28.7296 2.01402ZM21.721 5.8939V14.9488C21.7217 15.2046 21.6725 15.4581 21.5763 15.6947C21.4801 15.9314 21.3388 16.1465 21.1603 16.328C20.9819 16.5094 20.7698 16.6535 20.5362 16.752C20.3027 16.8506 20.0522 16.9017 19.7991 16.9024H3.01303C2.50283 16.9024 2.01345 16.6979 1.65218 16.3338C1.2909 15.9696 1.08722 15.4755 1.08578 14.9598V3.04024C1.08722 2.52451 1.2909 2.03039 1.65218 1.66623C2.01345 1.30206 2.50283 1.09756 3.01303 1.09756H19.7991C20.3084 1.09901 20.7964 1.30415 21.1565 1.66816C21.5166 2.03217 21.7195 2.52546 21.721 3.04024V5.8939ZM28.9142 13.8841C28.9145 14.1156 28.8512 14.3426 28.7315 14.5399C28.6118 14.7371 28.4403 14.897 28.2361 15.0016C28.0318 15.1063 27.8029 15.1516 27.5747 15.1326C27.3465 15.1136 27.128 15.0309 26.9435 14.8939L22.8013 11.8152V6.17378L26.9435 3.10061C27.1268 2.96357 27.344 2.8806 27.5712 2.86092C27.7983 2.84124 28.0263 2.88561 28.23 2.98911C28.4336 3.09262 28.6049 3.25119 28.7248 3.4472C28.8446 3.6432 28.9083 3.86897 28.9088 4.09939L28.9142 13.8841ZM15 7.4689L10.6569 4.36829C10.4466 4.21726 10.1992 4.12763 9.94189 4.10921C9.68456 4.09079 9.42717 4.14428 9.19791 4.26384C8.96864 4.38341 8.77633 4.56442 8.64204 4.78708C8.50774 5.00973 8.43662 5.26544 8.43648 5.52622V11.7274C8.43653 11.988 8.50745 12.2436 8.64149 12.4662C8.77554 12.6888 8.96755 12.8699 9.19653 12.9896C9.39683 13.0924 9.61795 13.1469 9.84256 13.1488C10.1346 13.1493 10.4194 13.0572 10.6569 12.8854L15 9.76829C15.1826 9.63687 15.3316 9.46319 15.4343 9.26177C15.5371 9.06034 15.5907 8.83699 15.5907 8.61036C15.5907 8.38374 15.5371 8.16039 15.4343 7.95896C15.3316 7.75754 15.1826 7.58387 15 7.45244V7.4689ZM14.354 8.89024L10.0109 11.9909C9.96298 12.025 9.90676 12.0452 9.84831 12.0493C9.78986 12.0533 9.73143 12.0411 9.67937 12.014C9.62731 11.9868 9.58361 11.9457 9.55304 11.8952C9.52247 11.8447 9.50619 11.7867 9.50597 11.7274V5.52622C9.50643 5.46716 9.52285 5.40935 9.55348 5.35905C9.5841 5.30875 9.62775 5.26788 9.6797 5.24085C9.72923 5.20914 9.78665 5.1923 9.84528 5.1923C9.90391 5.1923 9.96133 5.20914 10.0109 5.24085L14.354 8.34146C14.3964 8.37056 14.431 8.40987 14.4547 8.45585C14.4784 8.50183 14.4904 8.55304 14.4897 8.60488C14.4937 8.66028 14.4832 8.71577 14.4594 8.76583C14.4356 8.8159 14.3993 8.85879 14.354 8.89024Z"
              fill="gray"
            />
          </svg>
        </button>
      </div>
      )}
      {/* Overlay c치mara */}
      {showOverlay && (
        <PhotoOverlay
          onClose={() => setShowOverlay(false)}
          onSave={handleSavePhoto}
        />
      )}
    </div>
  );
};

export default AccordionStep;
